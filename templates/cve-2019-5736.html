{%- extends "base.html" %}
{%- block title %}Docker sandbox escape{% endblock %}
{%- block challenges_menu %}active{% endblock %}
{%- block content %}
    <div class="jumbotron" style="margin-bottom: 0px;">
        <h2>CVE-2019-5736 challenge</h2>
        <hr>
        <div class="container">
            <iframe src="/runc-cve-{{ name }}/" id="term" height="0px" width="0px" seamless="seamless" scrolling="no" style="overflow: hidden;"></iframe>
        </div>
    </div>
    <script>
        var intervalId = 0;
        var terminal = document.getElementById('term')

        function send_request() {
            var req = new XMLHttpRequest()
            req.open('GET', terminal.src, false)
            req.send()
            if (req.status == 200) {
                terminal.width = '100%'
                terminal.height = '500px'
                terminal.src = terminal.src
                clearInterval(intervalId)
            }
        };

        (function check() {
            var req = new XMLHttpRequest()
            req.open('GET', terminal.src, false)
            req.send()
            if (req.status != 200) {
                intervalId = setInterval(send_request, 3000)
            } else {
                terminal.width = '100%'
                terminal.height = '500px'
            }
        })();
    </script>
    {%- with messages = get_flashed_messages() %}
        {%- if messages %}
            {%- for msg in messages %}
                <p>{{ msg }}</p>
            {%- endfor %}
        {%- endif %}
    {%- endwith %}
{%- endblock %}